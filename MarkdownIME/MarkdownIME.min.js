var __extends=this&&this.__extends||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};if(!Element.prototype["scrollIntoViewIfNeeded"]){Element.prototype["scrollIntoViewIfNeeded"]=function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,t=this.getBoundingClientRect();if(t.bottom>e||t.top<0)this.scrollIntoView()}}var MarkdownIME;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){e.list=/^(UL|OL)$/i;e.li=/^LI$/i;e.cell=/^T[HD]$/i;e.line=/^(P|DIV|H\d|T[HD])$/i;e.blockquote=/^BLOCKQUOTE$/i;e.pre=/^PRE$/i;e.hr=/^HR$/i;e.autoClose=/^(area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i})(t=e.NodeName||(e.NodeName={}))})(t=e.Pattern||(e.Pattern={}));function n(e){var n=e.ownerDocument.defaultView.getSelection();var r=e.ownerDocument.createRange();var i=e;while(i.nodeType===Node.ELEMENT_NODE){var o=i.childNodes.length;while(--o!==-1){var a=i.childNodes[o];if(a.nodeType===Node.TEXT_NODE||a.nodeType===Node.ELEMENT_NODE){i=a;break}}if(o===-1){break}}if(t.NodeName.autoClose.test(i.nodeName))r.selectNode(i);else r.selectNodeContents(i);r.collapse(i.nodeName==="BR");n.removeAllRanges();n.addRange(r);i.parentElement.scrollIntoViewIfNeeded(true)}e.move_cursor_to_end=n;function r(e,t){if(t===void 0){t=true}if(!e)return false;return e.nodeType==Node.TEXT_NODE&&/^[\s\r\n]*$/.test(e.nodeValue)||e.nodeType==Node.COMMENT_NODE||t&&e.nodeName=="BR"}e.is_node_empty=r;function i(e){return!r(e)}e.is_node_not_empty=i;function o(e){if(!e)return false;if(e.nodeType!=1)return false;return t.NodeName.line.test(e.nodeName)||t.NodeName.li.test(e.nodeName)||t.NodeName.pre.test(e.nodeName)}e.is_node_block=o;function a(e){var t=d(e);var n=t.length;if(n==1&&t[0].nodeType==1){return a(t[0])}while(n--){var r=t[n];if(r.nodeType==Node.TEXT_NODE)continue;return false}return true}e.is_line_container_clean=a;function s(e){if(e.textContent.length!=0)return false;if(e.innerHTML.indexOf("<img ")>=0)return false;return true}e.is_line_empty=s;function l(e,t){var n=e.previousSibling;if(!n||n.nodeName!=t){n=e.ownerDocument.createElement(t);e.parentNode.insertBefore(n,e)}return n}e.get_or_create_prev_block=l;function d(e){return[].filter.call(e.childNodes,i)}e.get_real_children=d;function u(e,t){var n=[];var r;r=e.previousSibling;return n}e.get_line_nodes=u;function c(e,t){var n=[];var r=e.parentElement;while(r){n.push(r);if(r===t)break;r=r.parentElement}return n}e.build_parent_list=c;function h(e){return e.replace(/&/g,"&amp;").replace(/  /g," &nbsp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}e.text2html=h;function f(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}e.text2regex=f;function p(e){var t={nbsp:String.fromCharCode(160),amp:"&",quot:'"',lt:"<",gt:">"};return e.replace(/&(nbsp|amp|quot|lt|gt);/g,function(e,n){return t[n]})}e.html_entity_decode=p;function m(e){return e.replace(/^[\t\r\n ]+/,"").replace(/[\t\r\n ]+$/,"").replace(/[\t\r\n ]+/," ")}e.trim=m;function v(e,t){t.parentNode.replaceChild(e,t);e.appendChild(t)}e.wrap=v;function k(e,n,r){var i="<"+e;if(n){for(var o in n){if(!n.hasOwnProperty(o))continue;var a=""+n[o];a=a.replace(/&/g,"&amp;");a=a.replace(/"/g,"&quot;");a=a.replace(/</g,"&lt;");a=a.replace(/\t/g,"&#x9;");a=a.replace(/\r/g,"&#xA;");a=a.replace(/\n/g,"&#xD;");i+=" "+o+'="'+a+'"'}}i+=">";if(r){i+=r+"</"+e+">"}else if(!t.NodeName.autoClose.test(e)){i+="</"+e+">"}return i}e.generateElementHTML=k})(t=e.Utils||(e.Utils={}))})(MarkdownIME||(MarkdownIME={}));var MarkdownIME;(function(e){var t;(function(e){var t=function(){function e(e,t,n){this.i=0;this.iStack=[];this.renderer=e;this.document=t;this.tokens=n}e.prototype.toString=function(e){var t=e||this.tokens;return t.map(function(e){return typeof e.data==="string"?e.data:e.data.textContent}).join("")};e.prototype.toFragment=function(e){var t=this;var n=e||this.tokens;var r=this.document.createDocumentFragment();n.map(function(e){var n;if(typeof e.data==="string"){n=t.document.createTextNode(e.data)}else{n=e.data}r.appendChild(n)});return r};e.prototype.pushi=function(){this.iStack.push(this.i)};e.prototype.popi=function(){this.i=this.iStack.pop()};e.prototype.stacki=function(e){return this.iStack[this.iStack.length-e]};e.prototype.isToken=function(e,t){return e&&e.isToken&&e.data===t};e.prototype.splice=function(e,t){var n=[];for(var r=2;r<arguments.length;r++){n[r-2]=arguments[r]}var i=n.length;function o(n){if(n>=e-1+t)return n-1-t+i;if(n>e-1)return e-1;return n}this.i=o(this.i);this.iStack=this.iStack.map(o);var a=[].splice.apply(this.tokens,arguments);return a};e.prototype.execute=function(){var e=this;this.i=0;while(this.i<this.tokens.length){var t=this.tokens[this.i];if(t.isToken){var n=this.renderer.tokenChars[t.data].some(function(t){return t.Proc(e)})}this.i++}this.mergeTextNode();this.renderer.rules.forEach(function(t){var n=t&&t["afterProc"];if(typeof n==="function")n.call(t,e)});this.mergeTextNode()};e.prototype.mergeTextNode=function(){var e=this.tokens,t=e.length;while(--t>=1){var n=e[t];var r=e[t-1];if(typeof n.data!=="string"||typeof r.data!=="string")continue;r.data+=n.data;e.splice(t,1)}};e.prototype.debugDump=function(e){var t=0;var n="I = "+this.i+"\nSTACK = "+this.iStack.join(" -> ")+" \n 0	 "+JSON.stringify(this.tokens).slice(1,-1).replace(/},{/g,function(e){return"}\n "+ ++t+"	 {"});if(e){}return n};return e}();e.InlineRenderProcess=t;var n=function(){function e(){this.rules=[];this.tokenChars={}}e.prototype.RenderNode=function(e){var n=this.parse(e);var r=new t(this,e.ownerDocument,n);r.execute();var i=r.toFragment();if(e["innerHTML"]){e.innerHTML=""}else{while(e.firstChild){e.removeChild(e.firstChild)}}e.appendChild(i)};e.prototype.parse=function(e){var t=[];var n=e.childNodes,r=n.length,i=-1;var o="";function a(){o&&t.push({isToken:false,data:o});o=""}while(++i!==r){var s=n[i];if(s.nodeType!==Node.TEXT_NODE){t.push({isToken:false,data:s});continue}var l=false;var d=s.textContent;if(!d.length)continue;for(var u=0;u!==d.length;u++){var c=d.charAt(u);if(!l&&this.tokenChars.hasOwnProperty(c)){a();t.push({isToken:true,data:c});continue}else if(l)l=false;else if(c==="\\")l=true;o+=c}a()}return t};e.prototype.addRule=function(e){this.rules.push(e);if(e["Proc"]&&e["tokens"]){var t=this.tokenChars;e["tokens"].forEach(function(n){if(t[n]){t[n].push(e)}else{t[n]=[e]}})}};return e}();e.InlineRenderer=n})(t=e.Renderer||(e.Renderer={}))})(MarkdownIME||(MarkdownIME={}));var MarkdownIME;(function(e){var t;(function(t){var n=function(){function t(){this.childNodeName=null;this.parentNodeName=null;this.isTypable=true;this.removeFeatureMark=true}t.prototype.Elevate=function(t){var n=this.prepareElevate(t);if(!n)return null;var r;var i;if(!this.childNodeName){r=t}else{r=t.ownerDocument.createElement(this.childNodeName);while(t.firstChild){r.appendChild(t.firstChild)}t.parentNode.insertBefore(r,t);t.parentElement.removeChild(t)}if(!this.parentNodeName){i=null}else{if(r.previousElementSibling&&r.previousElementSibling.nodeName==this.parentNodeName){i=r.previousElementSibling;i.appendChild(r)}else{i=r.ownerDocument.createElement(this.parentNodeName);e.Utils.wrap(i,r)}}return{child:r,parent:i,feature:n}};t.prototype.prepareElevate=function(e){if(!e)return null;var t=this.featureMark.exec(e.textContent);if(!t)return null;if(this.removeFeatureMark){var n=e;n.innerHTML=n.innerHTML.replace(/&nbsp;/g,String.fromCharCode(160)).replace(this.featureMark,"")}return t};return t}();t.BlockRendererContainer=n;var r;(function(e){var t=function(e){__extends(t,e);function t(){e.call(this);this.name="unordered list";this.featureMark=/^\s*[\*\+\-]\s+/;this.childNodeName="LI";this.parentNodeName="UL"}return t}(n);e.UL=t;var r=function(e){__extends(t,e);function t(){e.call(this);this.name="ordered list";this.featureMark=/^\s*(\d+)\.\s+/;this.childNodeName="LI";this.parentNodeName="OL"}t.prototype.Elevate=function(t){var n=e.prototype.Elevate.call(this,t);if(n){n.parent.setAttribute("start",n.feature[1])}return n};return t}(n);e.OL=r;var i=function(e){__extends(t,e);function t(){e.call(this);this.name="blockquote";this.featureMark=/^(\>|&gt;)\s*/;this.parentNodeName="BLOCKQUOTE"}return t}(n);e.BLOCKQUOTE=i;var o=function(e){__extends(t,e);function t(){e.call(this);this.isTypable=false;this.name="hr";this.featureMark=/^\s{0,2}([\-_\=\*])(\s*\1){2,}$/}t.prototype.Elevate=function(e){if(!this.prepareElevate(e))return null;var t=e.ownerDocument.createElement("hr");e.parentElement.insertBefore(t,e);e.parentElement.removeChild(e);return{parent:null,child:t}};return t}(n);e.HR=o;var a=function(e){__extends(t,e);function t(){e.call(this);this.name="code block";this.featureMark=/^```(\s*(\w+)\s*)?$/;this.removeFeatureMark=false}t.prototype.Elevate=function(e){var t=this.prepareElevate(e);if(!t)return null;var n=e.ownerDocument;var r=n.createElement("code");var i=n.createElement("pre");r.innerHTML='<br data-mdime-bogus="true">';i.appendChild(r);e.parentNode.insertBefore(i,e);e.parentElement.removeChild(e);if(t[1]){i.setAttribute("lang",t[2]);r.setAttribute("class",t[2])}return{parent:i,child:r}};return t}(n);e.CodeBlock=a;var s=function(e){__extends(t,e);function t(){e.call(this);this.name="header text";this.featureMark=/^(#+)\s+/}t.prototype.Elevate=function(e){var t=this.prepareElevate(e);if(!t)return null;var n=e.ownerDocument.createElement("H"+t[1].length);while(e.firstChild){n.appendChild(e.firstChild)}e.parentNode.insertBefore(n,e);e.parentElement.removeChild(e);return{parent:null,child:n}};return t}(n);e.HeaderText=s;var l=function(e){__extends(t,e);function t(){e.call(this);this.name="table header";this.featureMark=/^\|(.+)\|$/;this.removeFeatureMark=false}t.prototype.Elevate=function(e){var t=this.prepareElevate(e);if(!t)return null;var n=e.ownerDocument;var r=n.createElement("table");var i=n.createElement("tbody");var o=n.createElement("tr");var a=t[1].split("|").map(function(e){var t=n.createElement("th");t.textContent=e.trim();o.appendChild(t);return t});r.appendChild(i);i.appendChild(o);var s=e.parentElement;s.insertBefore(r,e);s.removeChild(e);var l=n.createElement(e.nodeName);l.innerHTML='<br data-mdime-bogus="true">';s.insertBefore(l,r.nextElementSibling);return{parent:r,child:a[0]}};return t}(n);e.TableHeader=l})(r=t.BlockRendererContainers||(t.BlockRendererContainers={}));var i=function(){function e(){this.containers=[]}e.prototype.Elevate=function(e){for(var t=0;t<this.containers.length;t++){var n=this.containers[t];var r=n.Elevate(e);if(r){r.containerType=n;return r}}return null};e.prototype.GetSuggestedNodeName=function(e){for(var t=0;t<this.containers.length;t++){var n=this.containers[t];if(n.parentNodeName==e.nodeName)return n.childNodeName}return null};e.prototype.AddMarkdownRules=function(){this.containers=e.markdownContainers.concat(this.containers);return this};e.markdownContainers=[new r.CodeBlock,new r.TableHeader,new r.BLOCKQUOTE,new r.HeaderText,new r.HR,new r.OL,new r.UL];return e}();t.BlockRenderer=i})(t=e.Renderer||(e.Renderer={}))})(MarkdownIME||(MarkdownIME={}));var MarkdownIME;(function(e){var t;(function(e){var t=function(){function e(){}e.prototype.Proc=function(e){var t=e.stacki(1),n=e.tokens[t]||{isToken:false,data:""};var r=e.i,i=e.tokens[r];if(n.isToken&&this.isLeftBracket(e,n,t)&&i.isToken&&this.isRightBracket(e,i,r)){var o=e.stacki(1),a=e.i;this.ProcWrappedContent(e,o,a);e.popi();return true}else if(i.isToken&&this.isLeftBracket(e,i,r)){e.pushi();return true}return false};return e}();e.InlineBracketRuleBase=t})(t=e.Renderer||(e.Renderer={}))})(MarkdownIME||(MarkdownIME={}));var MarkdownIME;(function(e){var t;(function(e){var t;(function(t){t.InlineRules=["Emphasis","StrikeThrough","LinkAndImage","LinkAndImageData","InlineCode"];var n=function(e){__extends(t,e);function t(){e.apply(this,arguments);this.name="Markdown Emphasis";this.tokens=["*"];this.tagNameEmphasis="i";this.tagNameStrong="b"}t.prototype.isLeftBracket=function(e,t,n){return e.isToken(t,this.tokens[0])};t.prototype.isRightBracket=function(e,t,n){return e.isToken(t,this.tokens[0])};t.prototype.ProcWrappedContent=function(e,t,n){if(n===t+1){e.pushi();e.pushi();return}var r=e.tokens.slice(t+1,n);var i=this.tagNameEmphasis;var o=e.document;if(e.isToken(e.tokens[t-1],this.tokens[0])&&e.isToken(e.tokens[n+1],this.tokens[0])){i=this.tagNameStrong;t-=1;n+=1;e.popi()}else if(r.some(function(e){return!e.isToken&&/^(EM|I)$/.test(e.data["nodeName"])})){if(r.length>1){e.pushi();e.pushi()}else{e.splice(t,n-t+1);var a=r[0].data;var s=o.createElement(this.tagNameStrong);while(a.firstChild)s.appendChild(a.firstChild);e.splice(t,0,{isToken:false,data:s})}return}e.splice(t,n-t+1);var l=e.toFragment(r);var d=o.createElement(i);d.appendChild(l);e.splice(t,0,{isToken:false,data:d})};return t}(e.InlineBracketRuleBase);t.Emphasis=n;var r=function(e){__extends(t,e);function t(){e.apply(this,arguments);this.name="Markdown StrikeThrough";this.tokens=["~"];this.tagName="del"}t.prototype.isLeftBracket=function(e,t,n){return e.isToken(t,this.tokens[0])&&e.isToken(e.tokens[n-1],this.tokens[0])};t.prototype.isRightBracket=function(e,t,n){return e.isToken(t,this.tokens[0])&&e.isToken(e.tokens[n+1],this.tokens[0])};t.prototype.ProcWrappedContent=function(e,t,n){if(n===t+1)return;var r=e.document;var i=e.splice(t-1,n-t+3);i=i.slice(2,-2);var o=e.toFragment(i);var a=r.createElement(this.tagName);a.appendChild(o);e.splice(t-1,0,{isToken:false,data:a})};return t}(e.InlineBracketRuleBase);t.StrikeThrough=r;var i=function(e){__extends(t,e);function t(){e.apply(this,arguments);this.name="Markdown Link and Image";this.tokens=["[","]","!"]}t.prototype.isLeftBracket=function(e,t,n){return e.isToken(t,this.tokens[0])};t.prototype.isRightBracket=function(e,t,n){return e.isToken(t,this.tokens[1])};t.prototype.ProcWrappedContent=function(e,t,n){var r=e.document;var i;var o=e.tokens.slice(t+1,n);if(e.isToken(e.tokens[t-1],this.tokens[2])){i=r.createElement("img");i.setAttribute("alt",e.toString(o));t--}else{if(o.length===0)return;var a=e.toFragment(o);i=r.createElement("a");i.setAttribute("href","");i.appendChild(a)}e.splice(t,n-t+1,{isToken:false,data:i})};return t}(e.InlineBracketRuleBase);t.LinkAndImage=i;var o=function(){function e(){this.name="Markdown Link and Image Data";this.tokens=["(",")"]}e.prototype.Proc=function(e){var t=e.i,n=e.tokens[t];if(!e.isToken(n,this.tokens[0]))return false;var r=e.tokens[t-1];if(!r||r.isToken||!r.data["nodeName"])return false;var i=r.data;var o;if(i.tagName==="IMG"){o="src"}else if(i.tagName==="A"){o="href"}else{return false}while(++e.i<e.tokens.length){var a=e.tokens[e.i];if(e.isToken(a,this.tokens[1])){var s=e.toString(e.tokens.slice(t+1,e.i)).trim();i.setAttribute(o,s);e.splice(t,e.i-t+1);return true}}return false};return e}();t.LinkAndImageData=o;var a=function(){function e(){this.name="Markdown Inline Code";this.tokens=["`"]}e.prototype.Proc=function(e){var t=e.i,n=e.tokens[t];if(!e.isToken(n,this.tokens[0]))return false;while(++e.i<e.tokens.length){var r=e.tokens[e.i];if(e.isToken(r,this.tokens[0])){if(e.i===t+1){return false}var i=e.document.createElement("code");i.textContent=e.toString(e.tokens.slice(t+1,e.i)).trim();e.splice(t,e.i-t+1,{isToken:false,data:i});return true}}return false};return e}();t.InlineCode=a})(t=e.Markdown||(e.Markdown={}))})(t=e.Renderer||(e.Renderer={}))})(MarkdownIME||(MarkdownIME={}));var MarkdownIME;(function(e){var t;(function(t){var n=function(t){__extends(n,t);function n(){var e=this;t.call(this);this.name="Emoji";this.tokens=[":"];this.use_shortcuts=true;this.use_twemoji=true;this.twemoji_config={};this.shortcuts_cache=[];this.chars={smile:["😄","smiley"],happy:"😃",grin:["😀","grinning"],blush:"😊",wink:"😉",sad:["😔","pensive"],"+1":"👍","-1":"👎",heart_eyes:"😍",kiss:["😙","kissing"],tongue:"😜",flushed:"😳",relieved:"😌",unamused:"😒",disappointed:"😞",persevere:"😣",cry:"😢",joy:"😂",sob:"😭",sleepy:"😪",cold_sweat:"😰",sweat:"😓",weary:"😩",tired:"😫",fearful:["😨","fear"],scream:"😱",angry:"😠",rage:"😡",confounded:"😖",laugh:["😆","laughing","satisfied"],yum:"😋",mask:"😷",sunglasses:["😎","cool"],sleeping:"😴",dizzy:"😵",astonished:"😲",worry:["😟","worried"],frown:["😦","frowning"],anguished:"😧",imp:"👿",smiling_imp:"😈",open_mouth:"😮",neutral:"😐",confused:"😕",hushed:"😯",no_mouth:"😶",innocent:["😇","angel"],smirk:"😏",expressionless:"😑",joy_cat:"😹",pouting_cat:"😾",heart:["❤️","love"],broken_heart:"💔",two_hearts:"💕",sparkles:["✨","star"],fist:"✊",hand:"✋",raised_hand:"✋",cat:"🐱",mouse:"🐭",cow:"🐮",monkey:"🐵",star:"⭐",zap:"⚡",umbrella:"☔",hourglass:"⌛",watch:"⌚",black_joker:"🃏",mahjong:"🀄",coffee:"☕",anchor:"⚓",wheelchair:"♿",aries:"♈",taurus:"♉",gemini:"♊",cancer:"♋",leo:"♌",virgo:"♍",libra:"♎",scorpius:"♏",sagittarius:"♐",capricorn:"♑",aquarius:"♒",pisces:"♓",loop:"➰"};this.shortcuts={angry:[">:(",">:-("],blush:[':")',':-")'],broken_heart:["</3","<\\3"],confused:[":/",":-/",":\\",":-\\"],cry:[":'(",":'-(",":,(",":,-("],frowning:[":(",":-("],heart:["<3"],two_hearts:[/(<3|❤){2}/g],imp:["]:(","]:-("],innocent:["o:)","O:)","o:-)","O:-)","0:)","0:-)"],joy:[":')",":'-)",":,)",":,-)",":'D",":'-D",":,D",":,-D"],kissing:[":*",":-*"],laughing:["x-)","X-)"],neutral:[":|",":-|"],open_mouth:[":o",":-o",":O",":-O"],rage:[":@",":-@"],smile:[":D",":-D"],smiley:[":)",":-)"],smiling_imp:["]:)","]:-)"],sob:[":,'(",":,'-(",";(",";-("],tongue:[":P",":-P"],sunglasses:["8-)","B-)"],sweat:[",:(",",:-("],unamused:[":s",":-S",":z",":-Z",":$",":-$"],wink:[";)",";-)"]};for(var n in this.chars){var r=this.chars[n];if(r&&r["length"]&&r["length"]>1&&r[1]["length"]>1){var i=r.shift();r.push(n);r.forEach(function(t){return e.chars[t]=i})}}}n.prototype.isLeftBracket=function(e,t,n){return e.isToken(t,this.tokens[0])};n.prototype.isRightBracket=function(e,t,n){return e.isToken(t,this.tokens[0])};n.prototype.ProcWrappedContent=function(e,t,n){var r=e.tokens[t+1].data;if(n!==t+2)return false;if(typeof r!=="string")return false;var i=this.chars[r];if(typeof i!=="string")return false;e.splice(t,3,{isToken:false,data:i});return true};n.prototype.afterProc=function(e){if(!this.shortcuts_cache.length)this.UpdateShortcutCache();for(var t=0;t<e.tokens.length;t++){var n=e.tokens[t];if(typeof n.data!=="string")continue;var r=n.data;for(var i=this.shortcuts_cache.length-1;i>=0;i--){var o=this.chars[this.shortcuts_cache[i].targetName];r=r.replace(this.shortcuts_cache[i].regexp,o)}n.data=r}if(this.use_twemoji&&typeof twemoji!=="undefined"){var a=document.createElement("div");for(var t=0;t<e.tokens.length;t++){var n=e.tokens[t];if(typeof n.data!=="string")continue;var r=n.data;a.innerHTML=twemoji.parse(r,this.twemoji_config);var s=e.renderer.parse(a);s=[t,1].concat(s);[].splice.apply(e.tokens,s)}}};n.prototype.UpdateShortcutCache=function(){this.shortcuts_cache=[];for(var t in this.shortcuts){var n=this.shortcuts[t];for(var r=n.length-1;r>=0;r--){var i=n[r];if(!(i instanceof RegExp)){i=new RegExp(e.Utils.text2regex(i),"g")}this.shortcuts_cache.push({regexp:i,length:i.toString().length,targetName:t})}}this.shortcuts_cache.sort(function(e,t){return e.length-t.length})};return n}(e.Renderer.InlineBracketRuleBase);t.EmojiAddon=n})(t=e.Addon||(e.Addon={}))})(MarkdownIME||(MarkdownIME={}));var MarkdownIME;(function(e){var t;(function(t){t.inlineRenderer=new t.InlineRenderer;t.blockRenderer=new t.BlockRenderer;t.emojiRule=new e.Addon.EmojiAddon;t.Markdown.InlineRules.forEach(function(e){var n=t.Markdown[e];t.inlineRenderer.addRule(new n)});t.inlineRenderer.addRule(t.emojiRule);t.blockRenderer.AddMarkdownRules();function n(e){var n=t.blockRenderer.Elevate(e);if(n){if(!n.containerType.isTypable)return n.child;e=n.child}t.inlineRenderer.RenderNode(e);return e}t.Render=n})(t=e.Renderer||(e.Renderer={}))})(MarkdownIME||(MarkdownIME={}));var MarkdownIME;(function(e){var t=function(){function t(e,n){this.editor=e;this.document=e.ownerDocument;this.window=e.ownerDocument.defaultView;this.selection=this.window.getSelection();this.isTinyMCE=/tinymce/i.test(e.id);this.config=n||{};for(var r in t.globalConfig){this.config.hasOwnProperty(r)||(this.config[r]=t.globalConfig[r])}}t.prototype.Init=function(){if(!this.editor.hasAttribute("contenteditable"))return false;if(this.editor.hasAttribute("mdime-enhanced"))return false;this.editor.addEventListener("keydown",this.keydownHandler.bind(this),false);this.editor.addEventListener("keyup",this.keyupHandler.bind(this),false);this.editor.setAttribute("mdime-enhanced","true");return true};t.prototype.GetCurrentLine=function(t){var n;var r={line:null,parent_tree:[],half_break:false};var i=t.startContainer;if(this.isTinyMCE){var o=i;while(!e.Utils.is_node_block(o)){o=o.parentElement}if(!(i.childNodes.length==1&&i.firstChild.nodeName=="BR")){i=o;r.half_break=true}else if(e.Utils.Pattern.NodeName.pre.test(o.nodeName)){i=o}else if(e.Utils.Pattern.NodeName.cell.test(o.parentElement.nodeName)){i=o.parentElement;var a=o.previousSibling;var s=void 0;while(s=a.firstChild){i.insertBefore(s,a)}i.removeChild(a);i.removeChild(o)}else{i=o.previousSibling;o.parentElement.removeChild(o);if(e.Utils.Pattern.NodeName.list.test(i.nodeName)){var l=this.document.createElement("li");i.appendChild(l);i=l}}}else{if(i.nodeType===Node.TEXT_NODE){r.half_break=t.startOffset!==i.textContent.length}}while(!e.Utils.is_node_block(i)&&i!==this.editor){i=i.parentNode}if(i===this.editor){i=this.document.createElement(this.config.wrapper);var d=this.document.createRange();d.selectNodeContents(this.editor);d.surroundContents(i)}var u=e.Utils.build_parent_list(i,this.editor);r.line=i;r.parent_tree=u;return r};t.prototype.ProcessCurrentLine=function(t){var n=this.selection.getRangeAt(0);if(!n.collapsed)return;var r=this.GetCurrentLine(n);var i=r.line;var o=r.parent_tree;if(e.Utils.Pattern.NodeName.pre.test(i.nodeName)){var a=this.document.createElement("br");if(!this.isTinyMCE){n.deleteContents();n.insertNode(a);var s=a.nextSibling;if(s&&s.nodeType===Node.TEXT_NODE&&s.textContent.length===0){a.parentNode.removeChild(s)}if(!a.nextSibling){a.parentNode.appendChild(this.document.createElement("br"))}n.selectNodeContents(a.nextSibling);n.collapse(true);this.selection.removeAllRanges();this.selection.addRange(n);t.preventDefault()}var l=i.innerText;if(/^\n*(`{2,3})?\n*$/.test(l.substr(l.length-4))){var d=i.firstChild;var u=void 0;while(u=d.lastChild,u.nodeType===1&&u.nodeName==="BR"||u.nodeType===3&&/^\n*(```)?\n*$/.test(u.textContent))d.removeChild(u);this.CreateNewLine(i)}return}else if(e.Utils.is_line_empty(i)){var c=this.GenerateEmptyLine();if(e.Utils.Pattern.NodeName.list.test(i.parentNode.nodeName)){i.parentNode.removeChild(i);i=o.shift();if(e.Utils.Pattern.NodeName.list.test(i.parentNode.nodeName)){c=this.GenerateEmptyLine("li")}}else if(e.Utils.Pattern.NodeName.cell.test(i.nodeName)){var h=i.parentElement;var f=h.parentElement.parentElement;if(h.textContent.trim()===""){h.parentNode.removeChild(h);i=f}else{c=this.CreateNewCell(i);i=null}}else if(e.Utils.Pattern.NodeName.blockquote.test(i.parentNode.nodeName)){i.parentNode.removeChild(i);i=o.shift()}else{}i&&i.parentNode.insertBefore(c,i.nextSibling);e.Utils.move_cursor_to_end(c);t.preventDefault()}else{if(r.half_break)return;if(i.lastChild.attributes&&(i.lastChild.attributes.getNamedItem("data-mdime-bogus")||i.lastChild.attributes.getNamedItem("data-mce-bogus")))i.removeChild(i.lastChild);i=e.Renderer.Render(i);if(i.parentNode.nodeName==="PRE"){e.Utils.move_cursor_to_end(i);t.preventDefault()}else if(this.CreateNewLine(i)){t.preventDefault()}else{e.Utils.move_cursor_to_end(i)}}};t.prototype.CreateNewCell=function(t){if(!t||!e.Utils.Pattern.NodeName.cell.test(t.nodeName))return null;var n;var r=t.parentNode;var i=r.parentNode.parentNode;var o=this.document.createElement("tr");for(var a=r.childNodes.length;a--;){if(e.Utils.Pattern.NodeName.cell.test(r.childNodes[a].nodeName)){var s=o.insertCell(0);s.innerHTML=this.config.emptyBreak;if(r.childNodes[a]===t){n=s}}}r.parentNode.insertBefore(o,r.nextSibling);return n};t.prototype.CreateNewLine=function(t){var n;var r=e.Utils.Pattern.NodeName;if(r.cell.test(t.nodeName)){n=this.CreateNewCell(t);e.Utils.move_cursor_to_end(n);return true}if(r.line.test(t.nodeName)||r.pre.test(t.nodeName)||r.li.test(t.nodeName)||r.hr.test(t.nodeName)){var i=r.li.test(t.nodeName)?"li":null;n=this.GenerateEmptyLine(i);t.parentNode.insertBefore(n,t.nextSibling);e.Utils.move_cursor_to_end(n);return true}return false};t.prototype.keydownHandler=function(t){var n=this.selection.getRangeAt(0);if(!n.collapsed)return;var r=t.keyCode||t.which;var i=!(t.shiftKey||t.ctrlKey||t.altKey);if(i&&r===13){this.ProcessCurrentLine(t);return}else if(r===9||r>=37&&r<=40){var o=false;var a=e.Utils.build_parent_list(n.startContainer,this.editor);a.unshift(n.startContainer);var s=a.filter(e.Utils.is_node_block);if(e.Utils.Pattern.NodeName.cell.test(s[0].nodeName)){var l=s[0];var d=l.parentElement;var u=d.parentElement.parentElement;var c=null;var h=0;while(h<d.childElementCount&&!d.children[h].isSameNode(l))h++;if(h<d.childElementCount){switch(r){case 9:if(i)c=l.nextElementSibling||d.nextElementSibling&&d.nextElementSibling.firstElementChild||this.CreateNewCell(d.firstElementChild);else if(t.shiftKey)c=l.previousElementSibling||d.previousElementSibling&&d.previousElementSibling.lastElementChild||u.previousElementSibling;break;case 38:if(i)c=d.previousElementSibling&&d.previousElementSibling.children[h]||u.previousElementSibling;break;case 40:if(i)c=d.nextElementSibling&&d.nextElementSibling.children[h]||u.nextElementSibling;break}if(c!==null){n.selectNodeContents(c.lastChild||c);n.collapse(false);this.selection.removeAllRanges();this.selection.addRange(n);o=true}}}if(o){t.preventDefault()}}};t.prototype.instantRender=function(t,n){var r=t.startContainer.parentNode;var i=r;while(!e.Utils.is_node_block(i)){i=i.parentNode}if(i.nodeName==="PRE")return false;if(r.nodeName==="CODE")return false;if(r===i&&t.startContainer.nodeType===Node.TEXT_NODE&&t.startContainer===i.firstChild){var o=e.Renderer.blockRenderer.Elevate(i);if(o){var a=o.child;if(a.textContent.length===0){a.innerHTML=this.config.emptyBreak}n&&e.Utils.move_cursor_to_end(a);return}}t.setStart(r,0);var s=t.extractContents();e.Renderer.inlineRenderer.RenderNode(s);var l=r.firstChild;if(l.nodeType===Node.TEXT_NODE&&l.textContent===""){r.removeChild(l);l=r.firstChild}var d=s.lastChild;r.insertBefore(s,l);n&&e.Utils.move_cursor_to_end(d)};t.prototype.keyupHandler=function(e){var t=e.keyCode||e.which;var n=this.selection.getRangeAt(0);if(t===32&&n.collapsed&&n.startContainer.nodeType===Node.TEXT_NODE){this.instantRender(n,true)}};t.prototype.GenerateEmptyLine=function(e){if(e===void 0){e=null}var t;t=this.document.createElement(e||this.config.wrapper||"div");t.innerHTML=this.config.emptyBreak;return t};t.globalConfig={wrapper:"p",emptyBreak:/MSIE (9|10)\./.test(navigator.appVersion)?"":'<br data-mdime-bogus="true">'};return t}();e.Editor=t})(MarkdownIME||(MarkdownIME={}));var MarkdownIME;(function(e){var t;(function(e){var t=function(){function e(e,t){this.disappearing=false;this.timeout=300;this.style="\nposition: absolute; \nfont-size: 10pt; \ncolor: #363; \nborder: 1px solid #363; \nbackground: #CFC; \npadding: 2pt 5pt; \nborder-radius: 0 0 5pt 0; \nz-index: 32760; \ntransition: .3s ease; \nopacity: 0; \n";this.element=e;this.timeout=t}e.prototype.show=function(){requestAnimationFrame(function(){var e=this.dismiss.bind(this);this.element.style.opacity="1";this.element.addEventListener("mousemove",e,false);if(this.timeout)setTimeout(e,this.timeout)}.bind(this))};e.prototype.dismiss=function(){if(this.disappearing)return;this.disappearing=true;this.element.style.opacity="0";setTimeout(function(){this.element.parentNode.removeChild(this.element)}.bind(this),300)};e.makeToast=function(t,n,r){if(r===void 0){r=0}var i=n.ownerDocument||n["createElement"]&&n||i;var o=n.parentNode||n["createElement"]&&n["body"];var a=i.createElement("div");var s=new e(a,r);a.setAttribute("style",s.style);a.textContent=t;a.style.left=(n.offsetLeft||0)+"px";a.style.top=(n.offsetTop||0)+"px";o.appendChild(a);return s};e.SHORT=800;e.LONG=2e3;return e}();e.Toast=t})(t=e.UI||(e.UI={}))})(MarkdownIME||(MarkdownIME={}));/*!@preserve
    [MarkdownIME](https://github.com/laobubu/MarkdownIME)
    
    Copyright 2016 laobubu

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
var MarkdownIME;(function(e){function t(e){var n=e.document;var r;r=[].slice.call(n.querySelectorAll("[contenteditable], [designMode]"));[].forEach.call(n.querySelectorAll("iframe"),function(e){try{var n=t(e.contentWindow);r=r.concat(n)}catch(i){}});return r}e.Scan=t;function n(t){if(typeof t["length"]==="number"&&t[0]){return[].map.call(t,n)}var r;r=new e.Editor(t);if(r.Init())return r;return null}e.Enhance=n;function r(r){n(t(r)).forEach(function(t){if(!t)return;e.UI.Toast.makeToast("MarkdownIME Activated",t.editor,e.UI.Toast.SHORT).show()})}e.Bookmarklet=r})(MarkdownIME||(MarkdownIME={}));var MarkdownIME;(function(e){var t;(function(e){var t=function(){function e(){this.name="MathFormula";this.imgServer="http://latex.codecogs.com/gif.latex?";this.tokens=["$"]}e.prototype.Proc=function(e){var t=e.i,n=e.tokens[t];if(!e.isToken(n,this.tokens[0]))return false;while(++e.i<e.tokens.length){var r=e.tokens[e.i];if(e.isToken(r,this.tokens[0])){if(e.i===t+1){return false}var i=e.document.createElement("img");var o=e.toString(e.tokens.slice(t+1,e.i)).trim();var a=this.imgServer+encodeURIComponent(o);i.setAttribute("src",a);i.setAttribute("alt",o);e.tokens.splice(t,e.i-t+1,{isToken:false,data:i});return true}}return false};return e}();e.MathAddon=t})(t=e.Addon||(e.Addon={}))})(MarkdownIME||(MarkdownIME={}));